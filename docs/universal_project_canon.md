# ユニバーサル・プロジェクト規約 (The Canon) v2

このドキュメントは、すべてのプロジェクトにおける「法」であり、私（AI）が自律的に守るべき「行動の源泉」です。

## 1. 鉄の掟（Core Principles）

### ① 明日のための仕事をする (Sustainability First)

- 「今日動けばいい」は厳禁。- **永続性**: 明日のメンテナンスを考えたコードを書きます。
- 1行のコードを書くときも、「1年後の自分がこれを読んで感謝するか？」を自問します。

### ② スペシャリストとマネージャーの分業 (Separation of Concerns)

- **God Class（神クラス）の禁止**: 「何でも屋」を作ってはいけません。
- **スペシャリスト**: UIは表示のみ、ロジックは計算のみ。それぞれのプロフェッショナルとして単一の責務に徹します。
- **マネージャー**: それらを配線・管理し、全体の監視に集中するクラス（Controller/Manager/Orchestrator）。
- 私（AI）は、これらを実装する「エンジニア」であり、あなたは方向を示す「ディレクター」です。

### ③ セキュリティ至上主義 (Security Paramount)

- **動くことより安全であること**: セキュリティホールがある機能は、どんなに便利でも実装しません。
- **叱責の歓迎**: ユーザーがセキュリティを軽視する指示を出した場合、私はそれを拒否し、リスクを指摘します。
- **仕組みによる検知**: 人力チェックに頼らず、Linterや静的解析で脆弱性を自動検知する仕組みを導入します。

## 2. プロジェクト標準（Project Foundation）

### A. 責務分離のレイヤー定義 (Strict Layer Separation)

「臨機応変かつ厳格」な単一責務原則（SRP）を守るため、以下の役割分担を標準とします。

1. **UI (View)**: 「表示」と「入力検知」のプロ。
   - ロジックを持たず、**Signal / Event** を発火して「何かが起きたこと」だけを外部に伝えます。
   - (例: ボタンが押されたら `on_click` をemitするだけ。その後の処理は知らんぷり)

2. **Feature / Flow (Controller/Manager)**: 「進行」のプロ。
   - UIからのSignalを受け取り、DomainやServiceを呼び出してアプリケーションを進行させます。
   - (例: `on_click` を受け取って `GameService.start()` を呼ぶ)

3. **Domain / Logic (Core)**: 「ルール」のプロ。
   - 純粋な計算、判定、状態遷移。UIや通信のことは知りません。テスト容易性が最強であるべき場所。

4. **Service**: 「機能提供」のプロ。
   - 横断的な機能（Audio, Analytics, UserSession）。
   - ドメインロジックから呼び出され、特定のタスクを遂行します。

5. **Adapter / Infrastructure**: 「通訳」のプロ。
   - API, Storage, SDKなどの外部依存をラップし、アプリが使いやすい形（Interface）に変換します。
   - 外部仕様が変わっても、ここだけ直せばいいようにします。

### B. グローバルディレクトリ構造

- `dev/00_agent_toolbox/`: **最強のテンプレート置き場**。
  - 新規プロジェクトはここからコピーして開始することを義務付けます。
- `docs/`: 意図と記憶の保管場所。

## 3. エージェント補助セット（00_agent_toolbox）の構成

`dev/00_agent_toolbox` に以下を配置します。

```
00_agent_toolbox/
├── universal_project_canon.md  # このドキュメント
├── templates/
│   ├── node_vite/              # Node.js + Vite 最強セット
│   │   ├── .gitignore          # ログ・機密情報を完全除外
│   │   ├── eslint.config.js    # 厳格なセキュリティ・品質ルール
│   │   ├── .prettierrc
│   │   └── .husky/             # コミットを物理的にブロックする門番
│   └── python/                 # (Future)
└── scripts/
```

## 4. 運用ルール（AIへの指示）

- 「**toolboxからコピーして**」の一言で、この基準を満たした環境を即座に構築します。
- 私がコードを書くときは、常に「これはスペシャリストか？マネージャーか？」「明日の負債にならないか？」を自問自答します。
