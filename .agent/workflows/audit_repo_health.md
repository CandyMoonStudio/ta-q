---
description: リポジトリが Universal Project Canon に準拠しているか監査し、改善点を特定する
---

# リポジトリ健全性監査ワークフロー

このワークフローは、既存のリポジトリが Canon の基準（責務分離、セキュリティ、自動化）を満たしているかを点検し、改善プランを作成するための手順です。

1. **Canonの確認**
   - `00_agent_toolbox/universal_project_canon.md` を読み込み、最新の基準を把握する。

2. **基本構造チェック**
   - [ ] ルートに `docs/`, `tests/` があるか？
   - [ ] `.gitignore` に機密情報（.env, logs等）が含まれているか？ `agent.md` はあるか？
   - [ ] **Linter/Formatter** は設定されているか？ (`package.json` の `scripts` 確認)
   - [ ] **Husky** (Git Hooks) は有効か？

3. **責務分離（Layer Separation）のチェック**
   - `ls -R` で主要なソースコードを確認する。
   - [ ] **UI** がロジックを持っていないか？ Signal/Event を使っているか？
   - [ ] **Domain** が UI への依存を持っていないか？（純粋か？）
   - [ ] **Service** や **Adapter** が適切に切り出されているか？
   - [ ] **God Class**（巨大すぎるファイル）がないか？

4. **セキュリティチェック**
   - [ ] APIキーやパスワードのハードコードがないか `grep` で簡易チェック。
   - [ ] 依存パッケージに既知の脆弱性がないか (`npm audit`)。

5. **改善ロードマップの作成 (Solution Oriented)**
   - 単に「違反」と指摘するのではなく、現実的な改善プランを提案する。
   - **Plan A (Ideal)**: 理想的な状態への完全リファクタリング（時間がある場合）。
   - **Plan B (Realistic)**: 既存の動作を維持しつつ、ガードレール（Lint/Test）だけ導入する**段階的移行案**。
   - **Plan C (Critical Only)**: とりあえずセキュリティと重大なバグだけ直す応急処置。

   > [!NOTE]
   > 「ルール適用でがんじがらめになりそう」な場合は、正直にユーザーに相談すること（プラグマティズム条項）。
