<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QCL</title>
    <!-- Use Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=M+PLUS+Rounded+1c:wght@400;500;700&family=JetBrains+Mono:wght@400;700&family=Noto+Sans+JP:wght@400;700&display=swap"
        rel="stylesheet">
    <style>
        {
                {
                STYLES
            }
        }
    </style>
</head>

<body id="app-body">
    <header>
        <div style="display: flex; align-items: center; gap: 16px;">
            <h1>QCL</h1>
        </div>
        <div class="stats">
            {{TOTAL_COUNT}} items • Generated: {{GENERATED_DATE}}
        </div>
    </header>

    <div class="controls-area">
        <div class="search-box">
            <span class="search-icon">🔍</span>
            <input type="text" class="search-input" id="search-input" placeholder="検索 (ID, 問題, 解答, ジャンル...)">
        </div>
        <div class="filter-group">
            <select class="filter-select" id="status-filter">
                <option value="all">全ステータス</option>
                <option value="unset">未判定</option>
                <option value="ok">OK (採用)</option>
                <option value="ng">NG (却下)</option>
                <option value="debug">DEBUG (要修正)</option>
                <option value="hold">HOLD (保留)</option>
            </select>
            <select class="filter-select" id="genre-filter">
                <option value="all">全ジャンル</option>
                <!-- Generated dynamically -->
            </select>
        </div>
    </div>

    <div class="container">
        <table>
            <thead>
                <tr>
                    <th width="160">操作</th>
                    <th width="60">ID</th>
                    <th width="120">ジャンル</th>
                    <th>問題 / 解答</th>
                    <th>ローマ字 / 別解</th>
                    <th width="250" class="status-header">状態 / メモ</th>
                </tr>
            </thead>
            <tbody>
                {{TABLE_ROWS}}
            </tbody>
        </table>
    </div>

    <!-- Floating Action Button -->
    <button class="fab-add" onclick="openAddTab()" title="Add New Question">+</button>

    <!-- Drawer -->
    <div id="drawer">
        <div class="drawer-resizer"></div>
        <div class="drawer-header">
            <div class="drawer-title">メニュー</div>
            <button class="drawer-toggle-btn" onclick="toggleDrawer()"
                style="background:rgba(255,255,255,0.1); border:none; color:white; width:32px; height:32px; border-radius:50%; cursor:pointer; display:flex; align-items:center; justify-content:center; font-size:1.2rem;">✕</button>
        </div>
        <div class="drawer-tabs">
            <button class="drawer-tab-btn active" onclick="switchTab('review')" id="tab-review">レビュー</button>
            <button class="drawer-tab-btn" onclick="switchTab('add')" id="tab-add">新規追加</button>
        </div>

        <!-- Tab: Review -->
        <div id="content-review" class="drawer-content tab-content active">
            <h3
                style="margin-top:0; font-size:1.1rem; border-bottom:1px solid rgba(255,255,255,0.2); padding-bottom:10px; margin-bottom:20px;">
                レビュー操作</h3>

            <button class="btn-primary" onclick="copyMarkdownExport()"
                style="background:var(--accent); margin-bottom:10px;">
                📋 Markdownエクスポート
            </button>
            <p style="font-size:0.8em; opacity:0.7; margin-top:0;">
                GitHub Issues用に、却下(NG)/要修正(DEBUG)/保留(HOLD)の項目をクリップボードにコピーします。
            </p>

            <hr style="border-color:rgba(255,255,255,0.1); margin: 24px 0;">

            <p style="font-size:0.875rem; opacity:0.7; margin-bottom:10px;">
                生データ (バックアップ用)
            </p>
            <textarea id="report-area" readonly
                style="height:120px; font-family:'JetBrains Mono', monospace; font-size:0.8em;"></textarea>
            <button class="copy-btn" onclick="copyReport()"
                style="margin-top:8px; width:100%; padding:8px; background:rgba(255,255,255,0.1); border:none; color:white; cursor:pointer; border-radius:6px;">JSONをコピー</button>
        </div>

        <!-- Tab: Add New -->
        <div id="content-add" class="drawer-content tab-content">
            <div class="input-group">
                <label>ID (任意、空欄時はCLIで自動生成)</label>
                <input type="text" id="new-id" placeholder="qXXXXX (不明な場合は空欄)">
            </div>
            <div class="input-group">
                <label>問題文 *</label>
                <input type="text" id="new-text" placeholder="問題文を入力">
            </div>
            <div class="input-group">
                <label>解答 *</label>
                <input type="text" id="new-answer" placeholder="解答を入力">
            </div>
            <button class="btn-primary" onclick="addDraft()">リストに追加</button>

            <div class="draft-list" id="draft-list">
                <!-- Items go here -->
            </div>

            <button class="copy-btn" onclick="copyTsv()" style="margin-top: 16px;">📋 TSVとしてコピー</button>
        </div>
    </div>

    <!-- Data Injection -->
    <script>
        const SERVER_DATA = {{ SERVER_DATA }};
    </script>

    <!-- Application Logic -->
    <script>
        { { SCRIPTS } }
    </script>
</body>

</html>