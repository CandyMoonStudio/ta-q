<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QCL</title>
    <!-- Use Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=M+PLUS+Rounded+1c:wght@400;500;700&family=JetBrains+Mono:wght@400;700&family=Noto+Sans+JP:wght@400;700&display=swap"
        rel="stylesheet">
    {{STYLES}}
</head>

<body id="app-body">
    <header>
        <div style="display: flex; align-items: center; gap: 16px;">
            <h1>QCL</h1>
        </div>
        <div style="display: flex; align-items: center; gap: 12px; margin-left: auto;">
            <div class="stats">
                {{TOTAL_COUNT}} items ‚Ä¢ Generated: {{GENERATED_DATE}}
            </div>
            <button class="btn btn-reset" data-action="reset-all" title="ÂÖ®„Å¶„ÅÆ„É¨„Éì„É•„Éº„Éá„Éº„Çø„Çí„É™„Çª„ÉÉ„Éà"
                style="background: #ef4444; color: white; padding: 8px 16px; border-radius: 6px; border: none; cursor: pointer; font-weight: 600; font-size: 0.85em;">
                üîÑ Reset All
            </button>
        </div>
    </header>

    <div class="controls-area">
        <div class="search-box">
            <span class="search-icon">üîç</span>
            <input type="text" class="search-input" id="search-input" placeholder="Ê§úÁ¥¢ (ID, ÂïèÈ°å, Ëß£Á≠î, „Ç∏„É£„É≥„É´...)">
        </div>
        <div class="filter-group">
            <select class="filter-select" id="status-filter">
                <option value="all">ÂÖ®„Çπ„ÉÜ„Éº„Çø„Çπ</option>
                <option value="unset">Êú™Âà§ÂÆö</option>
                <option value="ok">OK (Êé°Áî®)</option>
                <option value="ng">NG (Âç¥‰∏ã)</option>
                <option value="debug">DEBUG (Ë¶Å‰øÆÊ≠£)</option>
                <option value="hold">HOLD (‰øùÁïô)</option>
            </select>
            <select class="filter-select" id="type-filter">
                <option value="all">Type: All</option>
                <!-- Generated dynamically -->
            </select>
            <select class="filter-select" id="tag-filter">
                <option value="all">Tag: All</option>
                <!-- Generated dynamically -->
            </select>
        </div>
    </div>

    <div class="container">
        <table>
            <thead>
                <tr>
                    <th width="160">Êìç‰Ωú</th>
                    <th width="100">Áä∂ÊÖã</th>
                    <th width="60">ID</th>
                    <th width="80">Èõ£ÊòìÂ∫¶</th>
                    <th width="80">Type</th>
                    <th width="120">Tags</th>
                    <th>ÂïèÈ°å / Ëß£Á≠î</th>
                    <th>„É≠„Éº„ÉûÂ≠ó / Âà•Ëß£</th>
                    <th width="200">„É°„É¢</th>
                </tr>
            </thead>
            <tbody>
                {{TABLE_ROWS}}
            </tbody>
        </table>
    </div>

    <!-- Floating Action Button -->
    <button class="fab-add" data-action="open-add" title="Add New Question">+</button>

    <!-- Drawer -->
    <div id="drawer">
        <div class="drawer-resizer"></div>
        <div class="drawer-header">
            <div class="drawer-title">„É°„Éã„É•„Éº</div>
            <button class="drawer-toggle-btn" data-action="toggle-drawer"
                style="background:rgba(255,255,255,0.1); border:none; color:white; width:32px; height:32px; border-radius:50%; cursor:pointer; display:flex; align-items:center; justify-content:center; font-size:1.2rem;">‚úï</button>
        </div>
        <div class="drawer-tabs">
            <button class="drawer-tab-btn active" data-tab="export">Export</button>
            <button class="drawer-tab-btn" data-tab="add">Add</button>
        </div>

        <div class="drawer-content active" id="content-export">
            <p style="font-size:0.9em; opacity:0.8;">ÁèæÂú®„ÅÆ„É¨„Éì„É•„ÉºÁä∂Ê≥Å„ÇíÂá∫Âäõ„Åó„Åæ„Åô„ÄÇ</p>

            <div style="margin-top:20px;">
                <label style="font-size:0.85em; opacity:0.7; display:block; margin-bottom:8px;">JSON Download</label>
                <div style="display:flex; flex-direction:column; gap:8px;">
                    <button class="btn-primary" data-action="download-json" data-target="prod"
                        style="background:#22c55e;">Download Prod (Êé°Áî®)</button>
                    <button class="btn-primary" data-action="download-json" data-target="ng"
                        style="background:#ef4444;">Download NG (Âç¥‰∏ã)</button>
                    <button class="btn-primary" data-action="download-json" data-target="debug"
                        style="background:#8b5cf6;">Download Debug (‰øÆÊ≠£)</button>
                </div>
            </div>

            <hr style="border:0; border-top:1px solid rgba(255,255,255,0.1); margin:20px 0;">

            <label style="font-size:0.85em; opacity:0.7;">Markdown Report</label>
            <textarea id="report-area"
                style="width:100%; height:150px; background:rgba(0,0,0,0.3); color:white; border:none; border-radius:4px; padding:8px; font-family:monospace; margin-top:8px;"></textarea>

            <button class="btn-primary" data-action="copy-markdown">Copy Markdown Report</button>
            <button class="btn-primary" data-action="copy-json" style="margin-top:8px; background:#4b5563;">Copy Raw
                JSON</button>
        </div>

        <div class="drawer-content" id="content-edit">
            <div class="input-group">
                <label>Editing ID</label>
                <div id="edit-id-display"
                    style="font-family:monospace; font-weight:bold; color:var(--accent); margin-bottom:10px;">-</div>
            </div>

            <div class="input-group">
                <label>Difficulty</label>
                <div class="edit-star-rating" id="edit-difficulty-stars"
                    style="font-size:1.5rem; color:#fbbf24; cursor:pointer;">
                    ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ
                </div>
            </div>

            <div class="input-group">
                <label>Type (Category)</label>
                <select id="edit-type-select" style="width:100%; padding:8px; border-radius:4px; margin-bottom:10px;">
                    <option value="">(None)</option>
                    <option value="fast">Fast</option>
                    <option value="knowledge">Knowledge</option>
                </select>
            </div>

            <div class="input-group">
                <label>Tags</label>
                <div id="edit-current-tags"
                    style="display:flex; flex-wrap:wrap; gap:4px; margin-bottom:8px; min-height:30px;">
                    <!-- Chips go here -->
                </div>
                <div style="display:flex; gap:4px;">
                    <input type="text" id="edit-new-tag" placeholder="Add custom tag..." list="tag-suggestions">
                    <button class="btn-primary" id="btn-add-tag"
                        style="width:auto; margin:0; padding:0 12px;">+</button>
                </div>
                <datalist id="tag-suggestions">
                    <!-- Populated by JS -->
                </datalist>

                <div style="margin-top:10px; font-size:0.8em; color:rgba(255,255,255,0.5);">
                    Recommended: History, Science, Geography, Culture, Sports, Entertainment, Japan, World
                </div>
            </div>

            <button class="btn-primary" id="btn-save-edit" style="margin-top:20px; background:#22c55e;">Save
                Changes</button>
        </div>

        <div class="drawer-content" id="content-add">
            <div class="input-group">
                <label>ID (Optional)</label>
                <input type="text" id="new-id" placeholder="Auto-generated if empty">
            </div>
            <div class="input-group">
                <label>Question</label>
                <input type="text" id="new-text">
            </div>
            <div class="input-group">
                <label>Answer</label>
                <input type="text" id="new-answer">
            </div>
            <button class="btn-primary" data-action="add-draft">Add Draft</button>

            <div class="draft-list" id="draft-list"></div>

            <div style="margin-top:20px; text-align:right;">
                <button class="btn copy-btn" data-action="copy-tsv"
                    style="background:rgba(255,255,255,0.1); color:white;">Copy All as TSV</button>
            </div>
        </div>
    </div>

    <!-- Data Injection -->
    <script>
        const SERVER_DATA = {{ SERVER_DATA }};
    </script>

    <!-- Footer with Credit -->
    <footer
        style="text-align: center; padding: 20px; color: rgba(255,255,255,0.6); font-size: 0.85em; border-top: 1px solid rgba(255,255,255,0.1); margin-top: 40px;">
        <span id="credit-link" style="cursor: pointer; transition: color 0.2s;"
            onmouseover="this.style.color='rgba(255,255,255,0.9)'"
            onmouseout="this.style.color='rgba(255,255,255,0.6)'">
            Made with ‚ù§Ô∏è by CandyMoonStudio
        </span>
    </footer>

    <!-- Save/Restore Modal -->
    <div id="save-restore-modal"
        style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 10000; align-items: center; justify-content: center;">
        <div
            style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 30px; border-radius: 12px; max-width: 500px; width: 90%; box-shadow: 0 10px 40px rgba(0,0,0,0.3);">
            <h2 style="margin: 0 0 20px 0; color: white; font-size: 1.5em;">üíæ „Éá„Éº„Çø„ÅÆ‰øùÂ≠ò„Å®Âæ©ÂÖÉ</h2>

            <div style="margin-bottom: 20px;">
                <h3 style="color: white; font-size: 1.1em; margin-bottom: 10px;">üì§ „Ç®„ÇØ„Çπ„Éù„Éº„Éà</h3>
                <button id="btn-export-code" class="btn"
                    style="width: 100%; background: #22c55e; color: white; padding: 12px; font-size: 1em; font-weight: 600;">
                    „Ç≥„Éº„Éâ„ÇíÁîüÊàê„Åó„Å¶„Ç≥„Éî„Éº
                </button>
                <textarea id="export-code-display" readonly
                    style="width: 100%; margin-top: 10px; padding: 10px; border-radius: 6px; border: none; font-family: monospace; font-size: 0.85em; resize: vertical; min-height: 80px; display: none;"></textarea>
            </div>

            <div style="margin-bottom: 20px;">
                <h3 style="color: white; font-size: 1.1em; margin-bottom: 10px;">üì• „Ç§„É≥„Éù„Éº„Éà</h3>
                <textarea id="import-code-input" placeholder="„Åì„Åì„Å´„Ç≥„Éº„Éâ„ÇíË≤º„Çä‰ªò„Åë„Å¶„Åè„Å†„Åï„ÅÑ..."
                    style="width: 100%; padding: 10px; border-radius: 6px; border: none; font-family: monospace; font-size: 0.85em; resize: vertical; min-height: 80px;"></textarea>
                <button id="btn-import-code" class="btn"
                    style="width: 100%; margin-top: 10px; background: #3b82f6; color: white; padding: 12px; font-size: 1em; font-weight: 600;">
                    Âæ©ÂÖÉ„Åô„Çã
                </button>
            </div>

            <button id="btn-close-modal" class="btn"
                style="width: 100%; background: rgba(255,255,255,0.2); color: white; padding: 10px; font-size: 0.9em;">
                Èñâ„Åò„Çã
            </button>
        </div>
    </div>

    <!-- Application Logic -->
    {{SCRIPTS}}
</body>

</html>